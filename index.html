<!DOCTYPE html>
<html lang="en-us">
<head>
    <title>Torunament Maker</title>
    <meta charset="utf-8">
    <meta name="author" content="Cody Wilhelm, Hayden Svancara, Ryan Huse">
    <meta name="description" content="Tournament Maker">

    <link rel="stylesheet" type="text/css" href="theme.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:700" rel="stylesheet">
    <script>


        function addTwo(col, numSpaceBetween, numId, numCol){
            var cell = document.createElement('div');
            cell.className = 'cell-info-top';
            cell.id = numCol + ":" + numId;
            numId += 1;
            cell.appendChild(document.createTextNode("Name"));
            col.appendChild(cell)

            for (var i = 0; i < numSpaceBetween; i++) {
                var cell = document.createElement('div');
                cell.className = 'cell-info-spacer';
                cell.appendChild(document.createTextNode(""));
                col.appendChild(cell);
            }

            var cell = document.createElement('div');
            cell.className = 'cell-info-bottom';
            cell.id = numCol + ":" + numId;
            numId += 1;
            cell.appendChild(document.createTextNode("Name"));
            col.appendChild(cell);

            return numId;
        }

        function addTwoSkip(col, numSpaceBetween, numId, numCol, num){
            var cell = document.createElement('div');
            cell.className = 'cell-info-top';
            cell.id = numCol + ":" + numId;
            numId += 1;
            cell.appendChild(document.createTextNode(""));
            col.appendChild(cell)

            for (var i = 0; i < numSpaceBetween; i++) {
                var cell = document.createElement('div');
                cell.className = 'cell-info-spacer';
                cell.appendChild(document.createTextNode(""));
                col.appendChild(cell);
            }

            var cell = document.createElement('div');
            cell.className = 'cell-info-bottom';
            cell.id = numCol + ":" + numId;
            numId += 1;
            if(num == 1) cell.appendChild(document.createTextNode("Name"));
            else cell.appendChild(document.createTextNode(""));
            col.appendChild(cell);

            return numId;
        }

        function createEvenBracketSingle(players, top, between, skipTop, numCol){
            var numPlayers = players;
            var numSpaceTop = top;
            var numSpaceBetween = between;
            var numId = 1;
            var wrap = document.getElementById('bracket-wrap');
            var col = document.createElement('div');
            col.className = "col";

            //spacer top
            for (var i = 0; i < numSpaceTop; i++) {
                var cell = document.createElement('div');
                cell.className = 'cell-spacer';
                cell.appendChild(document.createTextNode(""));
                col.appendChild(cell);
            }

            //if it is at the end
            if(numPlayers == 1 && skipTop == 0){
                var cell = document.createElement('div');
                cell.className = 'cell-info-top';
                cell.id = numCol + ":" + numId;
                numId += 1;
                cell.appendChild(document.createTextNode(""));
                col.appendChild(cell)
            }

            //if it needs to skip 2s
            var temp = skipTop - 1;
            for(var i = 0 ; i < temp; i += 2){
                if(i != 0){
                  for (var j = 0; j < numSpaceBetween; j++) {
                      var cell = document.createElement('div');
                      cell.className = 'cell-spacer';
                      cell.appendChild(document.createTextNode(""));
                      col.appendChild(cell);
                  }
                }
                numId = addTwoSkip(col, numSpaceBetween, numId, numCol, 2);
            }
            //if it needs to skip 1
            if(skipTop % 2 != 0){
                if(skipTop > 1){
                  for (var j = 0; j < numSpaceBetween; j++) {
                      var cell = document.createElement('div');
                      cell.className = 'cell-spacer';
                      cell.appendChild(document.createTextNode(""));
                      col.appendChild(cell);
                  }
                }
                numId = addTwoSkip(col, numSpaceBetween, numId, numCol, 1);
            }

            //double bracket
            var temp = Math.floor(numPlayers/2);
            for (var i = 0; i < temp; i++) {
                if(i != 0 || skipTop != 0){
                  for (var j = 0; j < numSpaceBetween; j++) {
                      var cell = document.createElement('div');
                      cell.className = 'cell-spacer';
                      cell.appendChild(document.createTextNode(""));
                      col.appendChild(cell);
                  }
                }
                if (skipTop == 0 && numCol != 1) numId = addTwoSkip(col, numSpaceBetween, numId, numCol, 2);
                else numId = addTwo(col, numSpaceBetween, numId, numCol);
            }

            //wrap-up
            wrap.appendChild(col);
            if(numPlayers+skipTop > 1){
                numPlayers = Math.ceil((numPlayers+skipTop)/2);
                numSpaceTop = numSpaceTop * 2;
                numSpaceBetween = numSpaceBetween * 2 + 1;
                createEvenBracketSingle(numPlayers, numSpaceTop, numSpaceBetween, 0, numCol+1);
            }
        }

        function createBracketSingle(players) {
            var numPlayers = players;
            var numSpaceTop = 1;
            var numSpaceBetween = 1;
            var numId = 1;
            var numCol = 1;
            var wrap = document.getElementById('bracket-wrap');
            document.getElementById('info-box').style.display = 'none';
            document.getElementById('create-button').style.display = 'none';
            document.getElementById('new-button').style.display = 'block';
            wrap.style.display = 'block';
            var col = document.createElement('div');
            col.className = "col";

            //calc pre-even-bracket size
            var temp = 2;
            while(temp <= numPlayers){
                temp = temp * 2;
            }
            temp = temp/2;

            //check if pre-even-bracket is neeed and make it or continue to even bracket
            if (temp != numPlayers){
                var loop = numPlayers - temp;
                //spacer top
                for (var i = 0; i < numSpaceTop; i++) {
                    var cell = document.createElement('div');
                    cell.className = 'cell-spacer';
                    cell.appendChild(document.createTextNode(""));
                    col.appendChild(cell);
                }
                //Pre-even-bracket creation
                for(var i = 0; i < loop; i++){
                    if(i != 0){
                      for (var j = 0; j < numSpaceBetween; j++) {
                          var cell = document.createElement('div');
                          cell.className = 'cell-spacer';
                          cell.appendChild(document.createTextNode(""));
                          col.appendChild(cell);
                      }
                    }
                    numId = addTwo(col, numSpaceBetween, numId, numCol);
                }
                //wrap-up for pre-even-bracket
                numPlayers = numPlayers-(loop+loop);
                numSpaceTop = numSpaceTop * 2;
                numSpaceBetween = numSpaceBetween * 2 + 1;
                wrap.appendChild(col);
                createEvenBracketSingle(numPlayers, numSpaceTop, numSpaceBetween, loop, numCol+1);
            }
            else{
                createEvenBracketSingle(numPlayers, numSpaceTop, numSpaceBetween, 0, numCol);
            }
        }

        function processString(str){

        }

        function newClick(){
            location.reload();
        }

        function createClick(){
            //processString(document.getElementById('info-box').value);
            var temp = document.getElementById('info-box').value;
            var array = temp.split(',');
            for(var i = 0; i < array.length; i++){
                array[i] = array[i].trim().replace(/&nbsp;/g, '');
                console.log(array[i]);
            }
        }
    </script>
</head>
<body>
    <div id='bracket-wrap'>
        <div id='header'>
            <h1>Tournament Bracket Maker</h1>
            <textarea id='info-box'></textarea>
            <div id="create-button" onclick="createClick()">Create Bracket</div>
            <div id="new-button" onclick="newClick()">New Bracket</div>
        </div>
    </div>
</body>
</html>
